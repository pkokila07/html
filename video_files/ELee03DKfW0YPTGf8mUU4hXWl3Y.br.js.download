var MMTimer,__assign,__spreadArray,VideoEvents;(function(n){var t=function(){function n(n,t,i){i===void 0&&(i=!0);this.start=function(){this.running||(this.running=!0,this.startedDate=(new Date).getTime(),this.timer=setTimeout(this.callback,this.remaining))};this.pause=function(){this.timer&&this.running&&(this.running=!1,clearTimeout(this.timer),this.remaining-=(new Date).getTime()-this.startedDate)};this.getTimeLeft=function(){return this.running&&(this.pause(),this.start()),this.remaining};this.getStateRunning=function(){return this.running};this.destroy=function(){this.running=!1;clearTimeout(this.timer);this.remaining=-1};this.callback=n;this.remaining=t;i===!0&&this.start()}return n}();n.Timer=t})(MMTimer||(MMTimer={}));__assign=this&&this.__assign||function(){return __assign=Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},__assign.apply(this,arguments)};__spreadArray=this&&this.__spreadArray||function(n,t,i){if(i||arguments.length===2)for(var r=0,f=t.length,u;r<f;r++)!u&&r in t||(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return n.concat(u||Array.prototype.slice.call(t))},function(){function vi(i){(e("started initialization",i),i&&!(i.length<2)&&i[1]&&w&&n)&&(ft=i[1].videoType,y=i[1].videoExtraInfo,t=i[1].bindEventSupportedList?i[1].bindEventSupportedList:t,dt=i[1].skipPerVideoCI,i[1].videoEventsConfig&&ti(i[1].videoEventsConfig),!lt&&n&&(at(),wi()),i[1].videoDuration&&tt(i),y&&rr(),e("finished initialization"),nt(i))}function yi(t){t&&!(t.length<2)&&t[1]&&w&&n&&ti(t[1])}function ti(n){var u,i,r;o=n;kt=(u=o.ci)===null||u===void 0?void 0:u.noci;i=o.ecietl;(i===null||i===void 0?void 0:i.length)&&(t=i);pi();r=o.tcic;(r===null||r===void 0?void 0:r.length)&&r.forEach(function(n){var t=n.inm;l[t]=n;n.ft>0&&(k[t]=n.ft);d(n.ste,t,et);d(n.pte,t,ot);d(n.cte,t,st);d(n.utte,t,gt);ht[t]=n.efs;ct[t]=n.dfs});e("Config: extra-CI",l)}function pi(){var t,n;for(t in Object.keys(c))n=c[t],typeof(n===null||n===void 0?void 0:n.destroy)==h&&(n.destroy(),e("clear timer (triggered by clearing video event config)",t));c={};l={};a={};k={};et={};ot={};st={};gt={};ht={};ct={}}function d(n,t,i){(n===null||n===void 0?void 0:n.length)&&i&&n.forEach(function(n){i[n]||(i[n]=new Set);i[n].add(t)})}function ii(n){var i=ht[n],r=ct[n],u=!1,t;if(i===null||i===void 0?void 0:i.length){for(t=0;t<i.length;t++)if(ri(i[t])){u=!0;break}}else u=!0;if(r===null||r===void 0?void 0:r.length)for(t=0;t<r.length;t++)if(ri(r[t])){u=!1;break}return u}function ri(n){if(n&&typeof _d==yt&&typeof _d.querySelector==h)try{return _d.querySelector(n)}catch(t){return e("invalid selector",n),!1}}function ui(n){return(n===null||n===void 0?void 0:n.size)?Array.from(n).filter(function(n){return ii(n)}):null}function wi(){(t===null||t===void 0?void 0:t.indexOf("video"))!=-1&&(sj_evt.bind(n.EmbedPlayer_ComponentUpdate,fi),sj_evt.bind(n.EmbedPlayer_Load,nt),sj_evt.bind(n.VideoCanvas_VideoPlaying,g),sj_evt.bind(n.VideoCanvas_VideoStopped,s),sj_evt.bind(n.VideoCanvas_VideoEnded,s),sj_evt.bind(n.VideoCanvas_VideoPlayerReady,tt));i&&(t===null||t===void 0?void 0:t.indexOf("preview"))!=-1&&(sj_evt.bind(i.PlayerDownloadEndEvt,ei),sj_evt.bind(i.PlayerStartEvt,g),sj_evt.bind(i.PlayerEndEvt,s),sj_evt.bind(i.PlayerErrEvt,s),sj_evt.bind(i.PlayerPauseEvt,s),sj_evt.bind(i.StopPlayEvt,s));lt=!0;sj_be(_w,pt,at)}function bi(){if(typeof(f===null||f===void 0?void 0:f.destroy)==h){if(b){var n=f.getTimeLeft();f.pause();n>0&&!p&&n<ai&&vt(!0)}f.destroy()}kt&&!p&&u&&vt(!1);f=null;p=!1;b=!1}function fi(n){bi();di(n);ki()}function ki(){v=null}function di(n){var r=it(n),i=st[r],t;(i===null||i===void 0?void 0:i.size)&&(t=Array.from(i),(t===null||t===void 0?void 0:t.length)&&t.forEach(function(n){var t=c[n],u=a[n],i,r;typeof(t===null||t===void 0?void 0:t.destroy)==h&&(i=l[n],i.atdoe>0&&(r=t.getTimeLeft(),t.pause(),r>0&&!u&&r<i.atdoe&&t.fireCallback==h&&(t.fireCallback(),a[n]=!0)),t.destroy());c[n]=null;a[n]=!1}))}function gi(){if(!p){if(f)f.start();else{var n=oi();f=new w(ir,n)}e("startTimer")}}function g(n){gi();nt(n)}function nt(n){var i=it(n),t=ui(et[i]);(t===null||t===void 0?void 0:t.length)&&t.forEach(function(t){var r=l[t];if(r)r.uvdbs&&tt(n);else return;r.ft>0||(k[t]=oi());nr(t);e("startTimer",t,i)})}function nr(n){var u=a[n],t,i,r;u||(t=c[n],t?t.start():(i=er(n),r=fr(n),c[n]=new w(r,i)))}function s(n){f===null||f===void 0?void 0:f.pause();e("pauseTimer");tr(n)}function tr(n){var i=it(n),t=ui(ot[i]);(t===null||t===void 0?void 0:t.length)&&t.forEach(function(n){var t=c[n];t&&(t.pause(),e("pauseTimer",n,i))})}function at(){(t===null||t===void 0?void 0:t.indexOf("video"))!=-1&&(sj_evt.unbind(n.EmbedPlayer_ComponentUpdate,fi),sj_evt.unbind(n.VideoCanvas_VideoPlaying,g),sj_evt.unbind(n.EmbedPlayer_Load,nt),sj_evt.unbind(n.VideoCanvas_VideoStopped,s),sj_evt.unbind(n.VideoCanvas_VideoEnded,s),sj_evt.unbind(n.VideoCanvas_VideoPlayerReady,tt));i&&(t===null||t===void 0?void 0:t.indexOf("preview"))!=-1&&(sj_evt.unbind(i.PlayerDownloadEndEvt,ei),sj_evt.unbind(i.PlayerStartEvt,g),sj_evt.unbind(i.PlayerEndEvt,s),sj_evt.unbind(i.PlayerErrEvt,s),sj_evt.unbind(i.PlayerPauseEvt,s),sj_evt.unbind(i.StopPlayEvt,s));lt=!1;sj_ue(_w,pt,at)}function tt(n){if(r=-1,n&&!(n.length<2)&&n[1]){var t=n[1];t.videoDuration>0&&(r=t.videoDuration*bt);switch(ft){case"video":b=r<=rt;break;case"preview":b=r<=ut}r>wt?v="long":r>0&&(v="short");e("update duration",r,v)}}function ei(n){if(r=-1,n&&!(n.length<5)&&n[4]){var t=n[4];t>0&&(r=t*bt)}}function e(n){for(var i=[],t=1;t<arguments.length;t++)i[t-1]=arguments[t];"object"===yt&&"object"===h}function it(n){return(n===null||n===void 0?void 0:n.length)?n[0]:""}function ir(){if(dt){e("Skip per video IsCI");return}vt(!0);e("IsCI")}function rr(){var n={TS:null,T:null,AppNS:ci},t={recoFeedbackType:null,videoExtraInfo:__assign({},y)};y&&(n=__assign(__assign({},n),y));u={j:n,r:t}}function vt(t){var r,f,e,i=u===null||u===void 0?void 0:u.j,s=u===null||u===void 0?void 0:u.r;i&&s&&(i.T=t?"IsCI":"IsNoCI",i.TS=(new Date).getTime(),((r=o===null||o===void 0?void 0:o.ci)===null||r===void 0?void 0:r.eld)&&(i=__assign(__assign({},i),o.ci.eld)),((e=(f=o===null||o===void 0?void 0:o.ci)===null||f===void 0?void 0:f.drld)===null||e===void 0?void 0:e.length)&&o.ci.drld.indexOf(ni.videoSubType)>=0&&(i.videoSubType=v),s.recoFeedbackType=t?"IsCI":"IsNoCI",pInstr.icd(i),typeof(sj_evt===null||sj_evt===void 0?void 0:sj_evt.fire)==h&&(sj_evt.fire(n.VideoEvent_SendRecoFeedback,s),sj_evt.fire(n.VideoCanvas_VideoCI,i)),p=t)}function ur(t){var f,r=l[t],i,e;r&&ii(t)&&(i=u===null||u===void 0?void 0:u.j,i)&&(i.T=r.t,i.TS=(new Date).getTime(),r.eld&&(i=__assign(__assign({},i),r.eld)),((f=r.drld)===null||f===void 0?void 0:f.length)&&r.drld.indexOf(ni.videoSubType)>=0&&(i.videoSubType=v),pInstr.icd(i),a[t]=!0,r.erf&&(e=u===null||u===void 0?void 0:u.r,e&&typeof(sj_evt===null||sj_evt===void 0?void 0:sj_evt.fire)==h&&sj_evt.fire(n.VideoEvent_SendRecoFeedback,e)))}function fr(n){return function(){ur(n)}}function oi(){switch(ft){case"video":return r>wt?li:r>0?Math.min(r,rt):rt;case"preview":return r>0?Math.min(r,ut):ut;default:return Number.MAX_SAFE_INTEGER}}function er(n){var t=k[n];return typeof t==si?t:Number.MAX_SAFE_INTEGER}var yt="object",si="number",h="function",hi="Video.CI",i=typeof VRHConsts!="undefined"?VRHConsts:null,n=typeof SharedEventString!="undefined"?SharedEventString:null,w=typeof MMTimer!="undefined"?MMTimer.Timer_FixPause||MMTimer.Timer:null,pt="unload",ci="video",wt=3e4,li=2e4,rt=8e3,ut=8e3,bt=1e3,ai=1e3,r,y,ft,f,p=!1,b=!1,u,kt=!1,t=["preview","video"],dt=!1,o=null,l={},c={},a={},k={},et={},ot={},st={},gt={},ht={},ct={},ni={videoSubType:"videoSubType"},v,lt=!1;sj_evt.bind(n===null||n===void 0?void 0:n.VideoCanvas_InitIsCIModule,vi,!0);sj_evt.bind(n===null||n===void 0?void 0:n.VideoCanvas_UpdateVideoEventsConfig,yi,!0);e("Configurable CI loaded")}(VideoEvents||(VideoEvents={}))